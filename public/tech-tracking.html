<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Tracking</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease-in-out;
        }
        .sidebar {
            transition: width 0.3s ease-in-out, padding 0.3s ease-in-out;
        }
        .sidebar-hidden {
            width: 0 !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
            overflow: hidden;
        }
        .main-content {
            transition: all 0.3s ease-in-out;
            flex: 1;
            overflow-y: auto;
        }
        .page-content {
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding: 2rem;
        }
    </style>
    <script>
        // Client-side check for authentication
        document.addEventListener('DOMContentLoaded', () => {
            const accessToken = localStorage.getItem('supabase.auth.token'); // Or wherever you store your token

            if (!accessToken) {
                // If no access token, redirect to login page
                window.location.href = '/login.html';
            }
            // In a real application, you might also want to validate the token's expiry
            // or make an API call to verify the session.
        });
    </script>
</head>
<body class="bg-gray-100 flex h-screen">

    <!-- Sidebar will be loaded here dynamically -->
    <div id="sidebar-container"></div>

    <!-- Main Content Area -->
    <div id="main-content" class="main-content">
        <!-- Main content is now inside this container which is centered by default -->
        <div class="page-content">
            <!-- Header with Toggle Button -->
            <header class="flex items-center justify-between mb-8">
                <button id="sidebar-toggle-btn" class="p-2 rounded-lg bg-gray-800 text-white hover:bg-gray-700 transition duration-200">
                    <svg id="toggle-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h1 id="main-title" class="text-3xl font-extrabold text-gray-800">Tech Tracking</h1>
                
                <!-- Sign Out Button -->
                <button onclick="signOut()" class="flex items-center space-x-2 py-2 px-4 rounded-lg bg-red-600 text-white hover:bg-red-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    <span>Sign Out</span>
                </button>

            </header>
            
            <!-- Tech Tracking Content -->
            <div id="tech-tracking-page" class="page">
                <div class="bg-white p-6 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300">
                    <h2 class="text-xl font-bold text-gray-700 mb-4">Tech Tracking Status</h2>
                    <p class="text-gray-500">
                        Use this page to keep track of all technical assets and their current status. You can log new assets, update existing ones, and view their history.
                    </p>
                </div>
                <!-- Additional Tech Tracking-specific content can be added here -->
            </div>
        </div>
    </div>

    <script type="module">
        // Import the loadSidebar function from the new sidebar-loader.js file
        import { loadSidebar } from './js/sidebar-loader.js'; 
        // --- Utility Functions for Custom Messages (if any) ---
        // Add showMessage function if needed for this page

        // Helper to get Supabase token for authorization
        function getAuthToken() {
            const token = localStorage.getItem('supabase.auth.token');
            return token ? `Bearer ${token}` : '';
        }

        // --- Sidebar Loading and Initialization ---
       // --- Sidebar Loading and Initialization ---
async function loadSidebar() {
    try {
        const response = await fetch('sidebar.html');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const sidebarHtml = await response.text();
        document.getElementById('sidebar-container').innerHTML = sidebarHtml;

        // Get references to elements AFTER they are loaded into the DOM
        const sidebar = document.getElementById('sidebar-inner');
        const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
        const toggleIcon = document.getElementById('toggle-icon');

        // Re-attach sidebar toggle logic for the main sidebar
        sidebarToggleBtn.addEventListener('click', () => {
            const isSidebarHidden = sidebar.classList.toggle('sidebar-hidden');
            if (isSidebarHidden) {
                toggleIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />`; // Hamburger
            } else {
                toggleIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />`; // Left arrow
            }
        });

        // Submenu specific elements
        const productionToggle = document.getElementById('production-toggle');
        const productionSubmenu = document.getElementById('production-submenu');
        const productionArrow = document.getElementById('production-arrow');

        // Submenu toggle logic: Show/hide when Production button is clicked
        if (productionToggle && productionSubmenu && productionArrow) {
            productionToggle.addEventListener('click', (event) => {
                event.preventDefault(); // Prevent default if the button was a link before
                productionSubmenu.classList.toggle('hidden');
                productionArrow.classList.toggle('rotate-90'); // Rotate arrow for visual feedback
            });
        }

        // Set active link based on current page
        const currentPath = window.location.pathname.split('/').pop(); // e.g., "dashboard.html"
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            const linkHref = link.getAttribute('href');
            if (linkHref === currentPath) {
                link.classList.add('bg-indigo-500', 'text-white');

                // If an active link is within the production submenu, open the submenu
                if (link.closest('#production-submenu')) {
                    if (productionSubmenu) productionSubmenu.classList.remove('hidden');
                    if (productionArrow) productionArrow.classList.add('rotate-90');
                    // Optional: Add a subtle background to the parent button to indicate it's open/active
                    if (productionToggle) productionToggle.classList.add('bg-gray-700'); 
                }
            } else {
                link.classList.remove('bg-indigo-500', 'text-white');
            }
        });

    } catch (error) {
        console.error('Error loading sidebar:', error);
        document.getElementById('sidebar-container').innerHTML = '<p class="text-red-500 p-4">Error loading sidebar.</p>';
    }
}

        document.addEventListener('DOMContentLoaded', () => {

            const signOutButton = document.getElementById('signOutBtn');
         // Attach click event listener
             if (signOutButton) {
             signOutButton.addEventListener('click', () => {
            localStorage.removeItem('supabase.auth.token'); // Clear the token
            window.location.href = '/login.html'; // Redirect to login page
        });
     }
            // Load the sidebar first
            loadSidebar().then(() => {
                // If this page has specific data loading, call it here, e.g.:
                // loadTechTrackingData(); 
            }).catch(error => {
                console.error("Failed to load sidebar and initialize tech tracking page:", error);
            });
        });
    </script>
</body>
</html>
